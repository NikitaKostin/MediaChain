angular.module("ui.bootstrap.datetimepicker",["ui.bootstrap.dateparser","ui.bootstrap.position"]).constant("uiDatetimePickerConfig",{dateFormat:"yyyy-MM-dd HH:mm",defaultTime:"00:00:00",html5Types:{date:"yyyy-MM-dd","datetime-local":"yyyy-MM-ddTHH:mm:ss.sss",month:"yyyy-MM"},initialPicker:"date",reOpenDefault:!1,enableDate:!0,enableTime:!0,buttonBar:{show:!0,now:{show:!0,text:"Сейчас"},today:{show:!0,text:"Сегодня"},clear:{show:!0,text:"Очистить"},date:{show:!0,text:"Дата"},time:{show:!0,text:"Время"},close:{show:!0,text:"Закрыть"}},closeOnDateSelection:!0,appendToBody:!1,altInputFormats:[],ngModelOptions:{}}).controller("DateTimePickerController",["$scope","$element","$attrs","$compile","$parse","$document","$timeout","$uibPosition","dateFilter","uibDateParser","uiDatetimePickerConfig","$rootScope",function(e,t,n,a,i,o,r,l,s,d,c,p){function u(n){var a=y[0],i=t[0].contains(n.target),o=void 0!==a.contains&&a.contains(n.target);!e.isOpen||i||o||e.$apply(function(){e.close(!1)})}function m(n){27===n.which&&e.isOpen?(n.preventDefault(),n.stopPropagation(),e.$apply(function(){e.close(!1)}),t[0].focus()):40!==n.which||e.isOpen||(n.preventDefault(),n.stopPropagation(),e.$apply(function(){e.isOpen=!0}))}function f(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function g(t){var n=d.parse(t,v,e.date);if(isNaN(n))for(var a=0;a<M.length;a++)if(n=d.parse(t,M[a],e.date),!isNaN(n))return n;return n}function b(e){if(angular.isNumber(e)&&!isNaN(e)&&(e=new Date(e)),!e)return null;if(angular.isDate(e)&&!isNaN(e))return e;if(angular.isString(e)){var t=g(e);if(!isNaN(t))return d.toTimezone(t,h.timezone)}}function w(t){return e.datepickerOptions.minDate&&t<e.datepickerOptions.minDate?!1:e.datepickerOptions.maxDate&&t>e.datepickerOptions.maxDate?!1:!0}function k(e,t){var a=e||t;return n.ngRequired||n.required||a?(angular.isNumber(a)&&(a=new Date(a)),a?angular.isDate(a)&&!isNaN(a)?w(a):angular.isDate(new Date(a))&&!isNaN(new Date(a).valueOf())?w(new Date(a)):angular.isString(a)?!isNaN(g(t))&&w(g(viewVialue)):!1:!0):!0}var D,h,y,v=c.dateFormat,O={},$=[],x=angular.isDefined(n.closeOnDateSelection)?e.$parent.$eval(n.closeOnDateSelection):c.closeOnDateSelection,T=angular.isDefined(n.datepickerAppendToBody)?e.$parent.$eval(n.datepickerAppendToBody):c.appendToBody,M=angular.isDefined(n.altInputFormats)?e.$parent.$eval(n.altInputFormats):c.altInputFormats;this.init=function(i){if(D=i,h=D.$options||c.ngModelOptions,e.buttonBar=angular.isDefined(n.buttonBar)?e.$parent.$eval(n.buttonBar):c.buttonBar,e.enableDate=angular.isDefined(e.enableDate)?e.enableDate:c.enableDate,e.enableTime=angular.isDefined(e.enableTime)?e.enableTime:c.enableTime,e.initialPicker=angular.isDefined(n.initialPicker)?n.initialPicker:e.enableDate?c.initialPicker:"time",e.reOpenDefault=angular.isDefined(n.reOpenDefault)?n.reOpenDefault:c.reOpenDefault,"date"==e.initialPicker&&!e.enableDate)throw new Error("datetimePicker can't have initialPicker set to date and have enableDate set to false.");e.showPicker=e.enableDate?e.initialPicker:"time";var r=!1;if(c.html5Types[n.type]?(v=c.html5Types[n.type],r=!0):(v=n.datetimePicker||c.dateFormat,n.$observe("datetimePicker",function(e){var t=e||c.dateFormat;if(t!==v&&(v=t,D.$modelValue=null,!v))throw new Error("datetimePicker must have a date format specified.")})),!v)throw new Error("datetimePicker must have a date format specified.");var l=angular.element('<div date-picker-wrap><div uib-datepicker></div></div><div time-picker-wrap><div uib-timepicker style="margin:0 auto"></div></div>');h?(timezone=h.timezone,e.ngModelOptions=angular.copy(h),e.ngModelOptions.timezone=null,e.ngModelOptions.updateOnDefault===!0&&(e.ngModelOptions.updateOn=e.ngModelOptions.updateOn?e.ngModelOptions.updateOn+" default":"default"),l.attr("ng-model-options","ngModelOptions")):timezone=null,l.attr({"ng-model":"date","ng-change":"dateSelection(date)"});var s=angular.element(l.children()[0]);e.datepickerOptions||(e.datepickerOptions={}),r&&"month"===n.type&&(e.datepickerOptions.datepickerMode="month",e.datepickerOptions.minMode="month"),s.attr("datepicker-options","datepickerOptions"),angular.isDefined(e.datepickerOptions.datepickerMode)||(e.datepickerOptions.datepickerMode="day");var p=angular.element(l.children()[1]);e.timepickerOptions||(e.timepickerOptions={});for(var u in e.timepickerOptions)p.attr(f(u),"timepickerOptions."+u);angular.forEach(["minDate","maxDate","initDate"],function(t){e.datepickerOptions[t]&&("minDate"==t?p.attr("min","datepickerOptions.minDate"):"maxDate"==t&&p.attr("max","datepickerOptions.maxDate"))}),r?D.$formatters.push(function(t){return e.date=d.fromTimezone(t,h.timezone),t}):(D.$$parserName="datetime",D.$validators.datetime=k,D.$parsers.unshift(b),D.$formatters.push(function(t){return D.$isEmpty(t)?(e.date=t,t):(e.date=d.fromTimezone(t,h.timezone),v=v.replace(/M!/,"MM").replace(/d!/,"dd"),d.filter(e.date,v))})),D.$viewChangeListeners.push(function(){e.date=g(D.$viewValue)}),t.bind("keydown",m),y=a(l)(e),l.remove(),T?o.find("body").append(y):t.after(y)},e.getText=function(t){return e.buttonBar[t].text||c.buttonBar[t].text},e.doShow=function(t){return angular.isDefined(e.buttonBar[t].show)?e.buttonBar[t].show:c.buttonBar[t].show},e.dateSelection=function(a){if(e.enableTime&&"time"===e.showPicker&&(a||null!=a)&&(angular.isDefined(e.date)&&null!=e.date||(e.date=new Date),a&&null!=a)){var i=new Date(e.date);i.setHours(a.getHours()),i.setMinutes(a.getMinutes()),i.setSeconds(a.getSeconds()),i.setMilliseconds(a.getMilliseconds()),a=i}if(angular.isDefined(a)){if(!e.date){var o=angular.isDefined(n.defaultTime)?n.defaultTime:c.defaultTime,r=new Date("2001-01-01 "+o);isNaN(r)||null==a||(a.setHours(r.getHours()),a.setMinutes(r.getMinutes()),a.setSeconds(r.getSeconds()),a.setMilliseconds(r.getMilliseconds()))}e.date=a}var i=e.date?s(e.date,v,h.timezone):null;t.val(i),D.$setViewValue(i),x&&"time"!=e.showPicker&&null!=i&&(e.enableTime?e.open("time"):e.close(!1))},e.keydown=function(n){27===n.which&&(e.close(!1),t[0].focus())},e.$watch("isOpen",function(n){if(e.dropdownStyle={display:n?"block":"none"},n){O.openDate=e.date;var a=T?l.offset(t):l.position(t);T?e.dropdownStyle.top=a.top+t.prop("offsetHeight")+"px":e.dropdownStyle.top=void 0,e.dropdownStyle.left=a.left+"px",r(function(){e.$broadcast("uib:datepicker.focus"),o.bind("click",u)},0,!1),e.open(e.showPicker)}else o.unbind("click",u)}),e.isDisabled=function(t){("today"===t||"now"===t)&&(t=d.fromTimezone(new Date,timezone));var n={};return angular.forEach(["minDate","maxDate"],function(t){e.datepickerOptions[t]?angular.isDate(e.datepickerOptions[t])?n[t]=d.fromTimezone(new Date(e.datepickerOptions[t]),timezone):n[t]=new Date(s(e.datepickerOptions[t],"medium")):n[t]=null}),e.datepickerOptions&&n.minDate&&e.compare(t,n.minDate)<0||n.maxDate&&e.compare(t,n.maxDate)>0},e.compare=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate())-new Date(t.getFullYear(),t.getMonth(),t.getDate())},e.select=function(t){var n=null;if("today"===t||"now"==t){var a=new Date;angular.isDate(e.date)?(n=new Date(e.date),n.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),n.setHours(a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())):n=a}e.dateSelection(n)},e.open=function(t,n){angular.isDefined(n)&&(n.preventDefault(),n.stopPropagation()),r(function(){e.showPicker=t},0),"time"==t&&r(function(){e.date=g(D.$viewValue)},50)},e.close=function(n){e.isOpen=!1,e.enableDate&&e.enableTime&&(e.showPicker=e.reOpenDefault===!1?"date":e.reOpenDefault),angular.isDefined(n)&&e.whenClosed({args:{closePressed:n,openDate:O.openDate||null,closeDate:e.date}}),t[0].focus()},e.$on("$destroy",function(){e.isOpen===!0&&(p.$$phase||e.$apply(function(){e.close()})),$.forEach(function(e){e()}),y.remove(),t.unbind("keydown",m),o.unbind("click",u)})}]).directive("datetimePicker",function(){return{restrict:"A",require:["ngModel","datetimePicker"],controller:"DateTimePickerController",scope:{isOpen:"=?",datepickerOptions:"=?",timepickerOptions:"=?",enableDate:"=?",enableTime:"=?",initialPicker:"=?",reOpenDefault:"=?",whenClosed:"&"},link:function(e,t,n,a){var i=a[0],o=a[1];o.init(i)}}}).directive("datePickerWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"template/date-picker.html"}}).directive("timePickerWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"template/time-picker.html"}}),angular.module("ui.bootstrap.datetimepicker").run(["$templateCache",function(e){"use strict";e.put("template/date-picker.html",'<ul class="dropdown-menu dropdown-menu-left datetime-picker-dropdown" ng-if="isOpen && showPicker == \'date\'" ng-style=dropdownStyle style=left:inherit ng-keydown=keydown($event) ng-click=$event.stopPropagation()><li style="padding:0 5px 5px 5px" class=date-picker-menu><div ng-transclude></div></li><li style=padding:5px ng-if=buttonBar.show><span class="btn-group pull-left" style=margin-right:10px ng-if="doShow(\'today\') || doShow(\'clear\')"><button type=button class="btn btn-sm btn-info" ng-if="doShow(\'today\')" ng-click="select(\'today\')" ng-disabled="isDisabled(\'today\')">{{ getText(\'today\') }}</button> <button type=button class="btn btn-sm btn-danger" ng-if="doShow(\'clear\')" ng-click="select(\'clear\')">{{ getText(\'clear\') }}</button></span> <span class="btn-group pull-right" ng-if="(doShow(\'time\') && enableTime) || doShow(\'close\')"><button type=button class="btn btn-sm btn-default" ng-if="doShow(\'time\') && enableTime" ng-click="open(\'time\', $event)">{{ getText(\'time\')}}</button> <button type=button class="btn btn-sm btn-success" ng-if="doShow(\'close\')" ng-click=close(true)>{{ getText(\'close\') }}</button></span> <span class=clearfix></span></li></ul>'),e.put("template/time-picker.html",'<ul class="dropdown-menu dropdown-menu-left datetime-picker-dropdown" ng-if="isOpen && showPicker == \'time\'" ng-style=dropdownStyle style=left:inherit ng-keydown=keydown($event) ng-click=$event.stopPropagation()><li style="padding:0 5px 5px 5px" class=time-picker-menu><div ng-transclude></div></li><li style=padding:5px ng-if=buttonBar.show><span class="btn-group pull-left" style=margin-right:10px ng-if="doShow(\'now\') || doShow(\'clear\')"><button type=button class="btn btn-sm btn-info" ng-if="doShow(\'now\')" ng-click="select(\'now\')" ng-disabled="isDisabled(\'now\')">{{ getText(\'now\') }}</button> <button type=button class="btn btn-sm btn-danger" ng-if="doShow(\'clear\')" ng-click="select(\'clear\')">{{ getText(\'clear\') }}</button></span> <span class="btn-group pull-right" ng-if="(doShow(\'date\') && enableDate) || doShow(\'close\')"><button type=button class="btn btn-sm btn-default" ng-if="doShow(\'date\') && enableDate" ng-click="open(\'date\', $event)">{{ getText(\'date\')}}</button> <button type=button class="btn btn-sm btn-success" ng-if="doShow(\'close\')" ng-click=close(true)>{{ getText(\'close\') }}</button></span> <span class=clearfix></span></li></ul>')}]);